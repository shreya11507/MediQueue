<!DOCTYPE html> 
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MediQueue - Book Now (Prototype)</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
<style>
:root {
  --primary: #4AB0A6;
  --secondary: #2C7A7B;
  --background: #E6F4F1;
  --white: #FFFFFF;
  --text: #333333;
}
body { margin:0; font-family:'Poppins',sans-serif; background: var(--background);}
.header { display:flex; justify-content:space-between; align-items:center; padding:15px 30px; background:var(--primary); color:var(--white);}
.logo { font-size:22px; font-weight:bold; display:flex; align-items:center;}
.nav-links a { margin-left:20px; color:var(--white); text-decoration:none; font-weight:500; padding:5px 0; transition: color 0.3s, border-bottom 0.3s; }
.nav-links a.active { border-bottom:2px solid var(--white);}
.nav-links a:hover { color:var(--secondary); border-bottom:2px solid var(--secondary);}
.main-layout { display:flex; }
.sidebar { width:200px; background: var(--secondary); min-height:100vh; padding-top:20px; }
.sidebar ul { list-style:none; padding:0; }
.sidebar li { margin:15px 0; }
.sidebar a { text-decoration:none; color: var(--white); font-weight:500; padding:10px 20px; display:block; border-radius:6px;}
.sidebar a.active, .sidebar a:hover { background:var(--primary); color: var(--white);}
.content { flex:1; padding:20px; }
h1 { color: var(--primary); margin-bottom:10px;}
.subtitle { color: gray; margin-bottom:20px;}
.step { background: var(--white); padding:20px; border-radius:12px; margin-bottom:15px; box-shadow:0 4px 10px rgba(0,0,0,0.05); }
.step h2 { margin:0 0 10px 0; color: var(--primary);}
.hidden { display:none; }
input, select, textarea { width:100%; padding:8px; margin:5px 0; border-radius:5px; border:1px solid #ccc; font-family:'Poppins',sans-serif;}
select:hover, select:focus { border:1px solid var(--primary); }
textarea { resize:none; }
button { padding:10px 20px; border:none; border-radius:6px; cursor:pointer; background:var(--primary); color: var(--white); font-family:'Poppins',sans-serif; transition:0.3s; margin-top:5px;}
button:hover { background: var(--secondary); color: var(--white);}
.accordion { background: var(--primary); color: var(--white); cursor:pointer; padding:15px 20px; margin-bottom:10px; border-radius:8px; font-weight:500; transition:0.3s; }
.accordion:hover { background: var(--secondary); }
.time-slot { display:inline-block; padding:10px 15px; margin:5px 5px 5px 0; border:2px solid var(--primary); border-radius:8px; cursor:pointer; transition:all 0.3s;}
.time-slot.selected { background:var(--primary); color:var(--white); transform:scale(1.05);}
.time-slot.unavailable { opacity:0.5; cursor:not-allowed; border-color:gray; pointer-events: none; }
.time-slot:hover { border-color: var(--secondary); }
.token-ticket {
  position: relative;
  background: var(--white);
  border: 3px solid var(--secondary);
  padding: 28px 32px;
  max-width: 400px;
  margin: 20px auto;
  box-shadow: 0 10px 18px rgba(0,0,0,0.15);
  --cut: 16px;
  clip-path: polygon(
    var(--cut) 0, calc(100% - var(--cut)) 0, 100% var(--cut),
    100% calc(100% - var(--cut)), calc(100% - var(--cut)) 100%, var(--cut) 100%,
    0 calc(100% - var(--cut)), 0 var(--cut)
  );
  animation: popIn 0.4s ease-out;
}
@keyframes popIn {
  0%   { transform: scale(0.92); opacity: 0; }
  100% { transform: scale(1);    opacity: 1; }
}
.token-header { text-align: center; font-size: 22px; font-weight: 700; color: var(--secondary); margin-bottom: 12px; }
.divider { border-top: 2px dashed var(--primary); margin: 14px 0 20px; }
.token-details { font-size: 15px; line-height: 1.9; }
.token-details p { margin: 2px 0; display: flex; justify-content: space-between; }
.label { font-weight: 600; color: var(--secondary); }
.value { color: var(--text); }
.modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.5); justify-content:center; align-items:center; z-index:1000; overflow:hidden;}
.modal-content { background: var(--white); padding: 20px 25px; border-radius: 12px; text-align: center; width: 400px; max-height: 90vh; overflow-y: auto; position: relative; animation: fadeIn 0.4s; }
.modal-close { position: absolute; top: 10px; right: 15px; font-size: 22px; font-weight: bold; color: var(--secondary); cursor: pointer; transition: color 0.3s; }
.modal-close:hover { color: var(--primary); }
.confetti-piece { position: absolute; width: 10px; height: 14px; background-color: red; opacity: 0.8; top: -20px; animation: fall 3s linear forwards; }
@keyframes fall { to { transform: translateY(100vh) rotateZ(360deg); opacity:0; } }
</style>
</head>
<body>

<header class="header">
  <div class="logo">
    <img src="https://cdn-icons-png.flaticon.com/512/6205/6205008.png" alt="MediQueue Logo" style="height:40px; margin-right:8px;">
    MediQueue
  </div>
  <nav class="nav-links">
    <a href="landing page.html">Home</a>
    <a href="dashboard.html" class="active">Dashboard</a>
    <a href="services.html">Services</a>
    <a href="logout.html">Logout</a>
  </nav>
</header>

<div class="main-layout">
<aside class="sidebar">
    <ul>
      <li><a href="dashboard.html" class="active">Dashboard</a></li>
      <li><a href="book_now.html">Book Token</a></li> <!-- âœ… Updated -->
      <li><a href="queue.html">View Queue Status</a></li>
      <li><a href="history.html">My Tokens</a></li>
      <li><a href="services.html">Services</a></li>
      <li><a href="profile.html">Profile</a></li>
      <li><a href="settings.html">Settings</a></li>
    </ul>
  </aside>

<div class="content">
<h1>ðŸ©º Book Your Appointment</h1>
<p class="subtitle">Follow the steps to complete your booking.</p>

<div class="step" id="step-dept">
<h2>Step 1: Choose Department</h2>
<div id="departmentsContainer"></div>
</div>

<div class="step hidden" id="step-date">
<h2>Step 2: Select Date</h2>
<input type="date" id="appointmentDate">
<button type="button" id="nextDateBtn">Next</button>
</div>

<div class="step hidden" id="step-slot">
<h2>Step 3: Select Time Slot</h2>
<div id="timeSlots"></div>
<button type="button" id="nextSlotBtn">Next</button>
</div>

<div class="step hidden" id="step-details">
<h2>Step 4: Patient Details</h2>
<div id="patientFormContainer"></div>
</div>
</div>
</div>

<!-- BOOKING CONFIRMATION MODAL -->
<div class="modal" id="confirmationModal">
  <div class="modal-content">
    <span class="modal-close" onclick="closeModal('confirmationModal')">Ã—</span>
    <h3>ðŸŽ‰ Booking Confirmed!</h3>
    <button type="button" onclick="openModal('tokenModal')">View Token</button>
  </div>
</div>

<!-- TOKEN MODAL -->
<div class="modal" id="tokenModal">
  <div class="modal-content">
    <span class="modal-close" onclick="closeModal('tokenModal')">Ã—</span>
    <div id="tokenContainer"></div>
  </div>
</div>

<script>
// Utility: returns YYYY-MM-DD for today + days
function getFutureDate(days){
  const d = new Date();
  d.setDate(d.getDate() + days);
  return d.toISOString().split('T')[0];
}

// ---------------- Mock Data ----------------
const departmentsList = [
  {name:'General Medicine', icon:'ðŸ’Š', timing:'8 AM â€“ 8 PM'},
  {name:'Cardiology', icon:'ðŸ«€', timing:'9 AM â€“ 5 PM'},
  {name:'Gynecology', icon:'ðŸ¤°', timing:'9 AM â€“ 5 PM'},
  {name:'Orthopedics', icon:'ðŸ¦´', timing:'10 AM â€“ 6 PM'},
  {name:'Neurology', icon:'ðŸ§ ', timing:'10 AM â€“ 2 PM'}
];

// Example: mark some slots on the "day after tomorrow" as unavailable by doctor
const unavailableSlots = {
  "Cardiology": {
    [getFutureDate(2)]: ["10:00 AM", "03:00 PM"]
  },
  "Orthopedics": {
    [getFutureDate(2)]: ["11:00 AM"]
  },
  // âœ… Added: General Medicine 25th September
  "General Medicine": {
    "2025-09-25": ["11:00 AM", "03:00 PM"]
  }
};

let selectedDept="", selectedSlot="", appointmentDate="", patientType="", patientID="";
let patientData={};
let patientCounter=0, tokenCounter=0;

// ---------------- Step 1: Departments ----------------
const deptContainer=document.getElementById('departmentsContainer');
departmentsList.forEach(dept=>{
  const div=document.createElement('div');
  div.className="accordion";
  div.innerText=`${dept.icon} ${dept.name} (${dept.timing})`;
  div.onclick=()=>{
    selectedDept=dept.name;
    document.getElementById('step-dept').classList.add('hidden');
    document.getElementById('step-date').classList.remove('hidden');
    setDateRange();
  };
  deptContainer.appendChild(div);
});

// ---------------- Step 2: Date ----------------
function setDateRange(){
  const dateInput=document.getElementById('appointmentDate');
  const minDate = getFutureDate(1);
  const maxDate = getFutureDate(3);
  dateInput.min = minDate;
  dateInput.max = maxDate;
  dateInput.value = minDate;
}

document.getElementById('nextDateBtn').addEventListener('click', ()=>{
  const dateInput=document.getElementById('appointmentDate').value;
  if(!dateInput){ alert("Please select a date"); return; }
  appointmentDate=dateInput;
  document.getElementById('step-date').classList.add('hidden');
  renderTimeSlots();
  document.getElementById('step-slot').classList.remove('hidden');
});

// ---------------- Step 3: Time Slots ----------------
function renderTimeSlots(){
  const container = document.getElementById('timeSlots');
  container.innerHTML="";
  const slots = ['09:00 AM','10:00 AM','11:00 AM','01:00 PM','03:00 PM'];
  const blocked = (unavailableSlots[selectedDept] && unavailableSlots[selectedDept][appointmentDate]) || [];

  // ðŸ”¹ Extra rule: if selected date is 24th of month => all unavailable
  const selectedDay = new Date(appointmentDate).getDate();
  const allBlocked = (selectedDay === 24);

  slots.forEach(slot=>{
    const btn = document.createElement('div');
    btn.className="time-slot";
    btn.innerText = slot;
    if(blocked.includes(slot) || allBlocked){
      btn.classList.add("unavailable");
      btn.title = allBlocked ? "All slots unavailable (doctor blocked this day)" : "Doctor marked this slot unavailable";
    } else {
      btn.onclick=()=>{
        selectedSlot=slot;
        container.querySelectorAll('.time-slot').forEach(s=>s.classList.remove('selected'));
        btn.classList.add('selected');
      };
    }
    container.appendChild(btn);
  });
}

document.getElementById('nextSlotBtn').addEventListener('click', ()=>{
  if(!selectedSlot){ alert("Please select time slot"); return; }
  document.getElementById('step-slot').classList.add('hidden');
  renderPatientForm();
  document.getElementById('step-details').classList.remove('hidden');
});

// ---------------- Step 4: Patient Details ----------------
function renderPatientForm(){
  const container=document.getElementById('patientFormContainer');
  container.innerHTML=`
    <label>Are you a new or returning patient?</label>
    <select id="pType">
      <option value="">Select</option>
      <option value="new">New Patient</option>
      <option value="returning">Returning Patient</option>
    </select>
    <div id="detailsForm"></div>
  `;

  document.getElementById('pType').addEventListener('change', (e)=> selectPatientType(e.target.value));
}

function selectPatientType(type){
  patientType = type;
  const formDiv = document.getElementById('detailsForm');
  if(type==='new'){
    formDiv.innerHTML=`
      <label>Name:</label><input type="text" id="pName" placeholder="Enter your name">
      <label>Date of Birth:</label><input type="date" id="pDob">
      <label>Gender:</label><select id="pGender"><option>Male</option><option>Female</option><option>Other</option></select>
      <label>Symptoms / Reason:</label><textarea id="pSymptoms" placeholder="Describe symptoms"></textarea>
      <label>Contact Number:</label><input type="text" id="pContact" placeholder="Enter contact">
      <button type="button" id="confirmBookingBtn">Confirm Booking</button>
    `;
  } else if(type==='returning'){
    formDiv.innerHTML=`
      <label>Enter your Patient ID:</label><input type="text" id="pID" placeholder="Enter Patient ID">
      <label>Symptoms / Reason:</label><textarea id="pSymptomsReturning" placeholder="Describe current symptoms"></textarea>
      <button type="button" id="confirmBookingBtn">Confirm Booking</button>
    `;
  } else { formDiv.innerHTML=""; }

  document.getElementById('confirmBookingBtn').addEventListener('click', confirmBooking);
}

function calculateAge(dob){
  const birthDate = new Date(dob);
  const today = new Date();
  let age = today.getFullYear() - birthDate.getFullYear();
  const m = today.getMonth() - birthDate.getMonth();
  if(m < 0 || (m === 0 && today.getDate() < birthDate.getDate())){
    age--;
  }
  return age;
}

function confirmBooking(){
  if(patientType==='new'){
    const name=document.getElementById('pName').value.trim();
    const dob=document.getElementById('pDob').value;
    const gender=document.getElementById('pGender').value;
    const symptoms=document.getElementById('pSymptoms').value;
    const contact=document.getElementById('pContact').value.trim();
    if(!name || !dob || !gender || !symptoms || !contact){ alert("Fill all fields"); return; }

    const age = calculateAge(dob);
    patientCounter++;
    patientID = "P" + String(patientCounter).padStart(3,'0');
    patientData={name, dob, age, gender, symptoms, contact};
    finalizeBooking(symptoms);
  } else {
    patientID=document.getElementById('pID').value.trim();
    const symptoms=document.getElementById('pSymptomsReturning').value.trim();
    if(!patientID){ alert("Enter valid Patient ID"); return; }
    if(!symptoms){ alert("Enter current symptoms"); return; }
    patientData={name:"Shreya", age:"--", gender:"--", contact:"--", symptoms};
    finalizeBooking(symptoms);
  }
}

function finalizeBooking(symptoms){
  tokenCounter++;
  const tokenNo = tokenCounter;
  document.getElementById('confirmationModal').style.display="flex";
  launchConfetti();
  showToken(tokenNo, symptoms);
}

function showToken(tokenNo, symptoms){
  const container=document.getElementById('tokenContainer');
  container.innerHTML=`
    <div class="token-ticket">
      <div class="token-header">ðŸŽŸ Appointment Token</div>
      <div class="divider"></div>
      <div class="token-details">
        <p><span class="label">Patient ID</span> <span class="value">${patientID}</span></p>
        <p><span class="label">Name</span> <span class="value">${patientData.name}</span></p>
        <p><span class="label">Department</span> <span class="value">${selectedDept}</span></p>
        <p><span class="label">Date</span> <span class="value">${appointmentDate}</span></p>
        <p><span class="label">Time Slot</span> <span class="value">${selectedSlot}</span></p>
        <p><span class="label">Symptoms</span> <span class="value">${symptoms}</span></p>
        <p><span class="label">Token No</span> <span class="value">${tokenNo}</span></p>
      </div>
    </div>
  `;
}

function openModal(id){ document.getElementById(id).style.display="flex"; }
function closeModal(id){ document.getElementById(id).style.display="none"; }

function launchConfetti(){
  const modal=document.getElementById('confirmationModal');
  for(let i=0;i<30;i++){
    const confetti=document.createElement('div');
    confetti.classList.add('confetti-piece');
    confetti.style.left=Math.random()*100+'%';
    confetti.style.backgroundColor=['#FF6347','#FFD700','#32CD32','#1E90FF','#FF69B4'][Math.floor(Math.random()*5)];
    confetti.style.animationDuration=2+Math.random()*2+'s';
    modal.appendChild(confetti);
    setTimeout(()=>confetti.remove(),3000);
  }
}
</script>
</body>
</html>
